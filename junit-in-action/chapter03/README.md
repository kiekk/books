## 3장 JUnit 마스터하기

```markdown
단위 테스트의 핵심은 한 번에 한 객체씩 테스트하는 데 있다.
자바와 같은 객체지향 환경에서의 객체들은 기본적으로 다른 객체와 상호작용하도록 설게된다.
단위 테스트를 작성하려면 두 가지 종류의 객체가 필요하다.
하나는 테스트 대상이 되는 도메인 객체이고, 다른 하나는 대상 객체와 상호작용할 테스트 객체다.
```

### JUnit 모범 사례: 한 번에 하나의 객체만 테스트하라.

```markdown
단위 테스트에서 중요한 것은 이들이 아주 잘게 나뉘어져 있다는 것이다.
단위 테스트는 여러분이 생성한 개개의 객체를 독립적으로 검사하므로, 문제가 발생하는 즉시 검출해낼 수 있다.
만약 한 번에 두 개 이상의 객체를 테스트한다면, 그중 한 객체만 수정되어도 서로 간에 어떤 영향을 줄지 예측하기 어렵다.
만약 테스트 대상 객체가 다른 복잡한 객체와 상호작용한다면, 복잡한 객체 대신 예측 가능한 테스트용 도우미 객체들로 감싸서 테스트해야 한다.
도메인 객체 간의 연동 테스트를 위해선 통합 테스트(integration test)라는 또 다른 종류의 소프트웨어 테스트가 대기하고 있다.
다른 종류의 테스트에 대해서는 4장을 참고하기 바란다.
```

### JUnit 모범 사례: 하나의 @Test 메서드에서는 하나의 테스트만 수행하라.

```markdown
여러 테스트를 하나의 메서드에 넣지 말자.
그 결과 이해하기 어려운 복잡한 테스트 메서드가 탄생할 것이다.
테스트 메서드가 더 많은 로직을 담을수록, 동작하지도 않는데다가 디버깅까지 해야 할 확율이 높아진다.
최악의 케이스는 '테스트를 테스트'하는 테스트 코드를 작성하는 상황이다.
단위 테스트는 잘 동작하던 기능이 오동작할 때 바로 알려줄 거라는 확신을 심어준다.
한 메서드에서 두 개 이상의 단위 테스트 수행하다면, 문제의 원인을 정확히 짚어내기가 그만큼 어려워진다.
여러 테스트가 한 메서드에서 실행되면, 실패한 테스트가 픽스쳐를 예상치 못한 상태로 남겨 놓기도 한다.
그렇게 되면 뒤이은 테스트들은 실행되지 않거나, 잘못된 방식으로 실행될 수 있다.
결국 테스트 결과는 불완전하거나 심지어 전혀 엉뚱한 데이터일 가능성이 생긴다.
같은 테스트 클래스 안의 모든 테스트 메서드는 같은 픽스쳐를 공유하고, 
JUnit이 테스트 스위트까지 알아서 만들어주기 때문에 단위 테스트당 하나의 메서드를 할당하는 것은 식은 죽 먹기다.
같은 코드 블록을 두 개 이상의 테스트가 사용해야 한다면, 유틸리티 메서드로 뽑아내어 필요한 테스트 메서드에서 호출하도록 한다.
모든 메서드가 공유하는 코드라면, 픽스쳐에 집어넣는 것이 더 좋은 선택이다.
테스트 메서드 안에서 assert 문을 전혀 사용하지 않는 것도 우리가 많이 저지르는 실수이다.
JUnit은 이런 테스트를 무조건 성공한 것으로 표기한다.
하지만 이는 환상일 뿐이니, 항상 assert 문을 호출하도록 해야 한다.
assert 문을 사용하지 않아도 좋은 유일한 경우는 예외를 던져 오류를 알리는 떄뿐이다.
최고의 결과를 얻으려면, 여러분의 테스트 메서드는 도메인 메서드만큼이나 간결하고 하나의 목표에만 집중해야 한다.
```

### JUnit 모범 사례: 실패할 가능성이 있는 모든 것을 테스트하라

```markdown
단위 테스트는 당신의 메서드가 다른 메서드들과의 API 계약을 잘 지키고 있음을 보장하는데 도움을 준다.
그 계약이 오로지 연관된 다른 컴포넌트가 각자의 계약을 잘 준수하는지에만 종속된다면, 테스트할 것이 별로 없을지도 모른다.
하지만 메서드가 어떤 방식으로건 파라미터나 필드의 값을 수정한다면, 테스트가 필요한 고유 기능이 존재한다는 의미이다.
향후 코드를 수정하면 오동작할 가능성이 있는 기능을 가지므로, 더 이상 단순 매개자로 볼 수 없다.
또한 단순했던 메서드도 수정이 가해지면서 복잡해졌다면, 수정 시에 테스트도 함께 추가해야 한다.
JUnit FAQ(http://junit.sourceforge.net/doc/faq/faq.html)에 보면 이런 말이 있다.
'일반적인 원칙은 이렇다. 스스로를 더 잘게 나눌 수 없다면, 나누기엔 너무 단순한 것이다'
이는 '미리부터 기능을 추가하지 말라.'는 익스트림 프로그래밍 규칙과도 일맥상통한다.
...
```

### JUnit 모범 사례: 예외 테스트도 읽기 쉽게 만들어라

```markdown
보통은 @Test 애노테이션의 expected 파라미터만으로도 개발자가 발생시키려는 예외가 무엇인지 명백히 알 수 있다.
하지만 조금만 더 선심을 써보자.
예외 상황 테스트임을 분명하게 말해주는 직관적인 테스트 메서드명과는 또 별개로 기대하는 예외를 발생시키는 코드 라인에 주석을 달아두면,
예외가 발생되는 지점까지 훨씬 쉽게 파악할 수 있다.
```
