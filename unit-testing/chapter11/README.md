## 11장. 단위 테스트 안티 패턴

### 11.1 비공개 메서드 단위 테스트

```markdown
단위 테스트와 관련해 자주 받는 질문 중 하나는 '비공개 메서드를 어떻게 테스트하는가?'이다.
짧게 대답하면 '전혀 하지 말아야 한다.'이지만, 이 주제는 약간의 뉘앙스를 담고 있다.
```

#### 11.1.1 비공개 메서드와 테스트 취약성

```markdown
단위 테스트를 하려고 비공개 메서드를 노출하는 경우에는 5장에서 다룬 기본 원칙 중 하나인 식별할 수 있는 동작만 테스트하는 것을 위반한다.
비공개 메서드를 노출하면 테스트가 구현 세부 사항과 결합되고 결과적으로 리팩터링 내성이 떨어진다.
비공개 메서드를 직접 테스트하는 대신, 포괄적인 식별할 수 있는 동작으로서 간접적으로 테스트하는 것이 좋다.
```

### 정리

```markdown
- 코드 오염은 테스트에만 필요한 제품 코드를 추가하는 것이다.
  이는 테스트 코드와 제품 코드가 혼재되게 하고 제품 코드의 유지비를 증가시키기 때문에 안티 패턴이다.
- 테스트를 작성할 때 특정 구현을 암시하지 말라.
  블랙박스 관점에서 제품 코드를 검증하라.
  또한 도메인 지식을 테스트에 유출하지 않도록 하라.
- 기능을 지키려고 구체 클래스를 목으로 처리해야 하면, 이는 단일 책임 원칙을 위반하는 결과다.
  해당 클래스를 두 가지 클래스, 즉 도메인 로직이 있는 클래스와 프로세스 외부 의존성과 통신하는 클래스로 분리하라.
- 현재 시간을 앰비언트 컨텍스트로 하면 제품 코드가 오염되고 테스트하기가 더 어려워진다.
  서비스나 일반 값의 명시적인 의존성으로 시간을 주입하라.
  가능하면 항상 일반 값이 좋다.
```
