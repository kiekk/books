## 4장. 좋은 단위 테스트의 4대 요소

```markdown
가치 있는 테스트를 작성하려면 가치 있는 테스트를 식별할 수 있어야 한다.
```

### 4.1 좋은 단위 테스트의 4대 요소 자세히 살펴보기

```markdown
좋은 단위 테스트에는 다음 네 가지 특성이 있다.
- 회귀 방지
- 리팩터링 내성
- 빠른 피드백
- 유지 보수성
```

#### 4.1.1 첫 번째 요소: 회귀 방지

```markdown
회귀는 소프트웨어 버그다.
코드를 수정한 후 (일반적으로 새 기능을 출시한 후) 기능이 의도한 대로 작동하지 않는 경우다.
...
코드베이스가 커질수록 잠재적인 버그에 더 많이 노출된다.
그렇기 때문에 회귀에 대해 효과적인 보호를 개발하는 것이 중요하다.
이러한 보호가 없다면 프로젝트가 오랫동안 성장할 수 없으며 점점 더 많은 버그가 쌓일 것이다.
회귀 방지 지표에 대한 테스트 점수가 얼마나 잘 나오는지 평가하려면 다음 사항을 고려해야 한다.
- 테스트 중에 실행되는 코드의 양
- 코드 복잡도
- 코드의 도메인 유의성
일반적으로 실행되는 코드가 많을수록 테스트에서 회귀가 나타날 가능성이 높다.
...
코드의 양뿐만 아니라 복잡도와 도메인 유의성도 중요하다.
복잡한 비즈니스 로직을 나타내는 코드가 보일러플레이트 코드보다 훨씬 더 중요하다.
비즈니스에 중요한 기능에서 발생한 버그가 가장 큰 피해를 입히기 때문이다.
반면에 단순한 코드를 테스트하는 것은 가치가 거의 없다.
이러한 코드는 짧고, 비즈니스 로직을 많이 담고 있지도 않다.
단순한 코드를 다루는 테스트는 실수할 여지가 많지 않기 때문에 회귀 오류가 많이 생기지 않는다.
...
게다가 여러분의 코드 외에 작성하지 않은 코드(예: 라이브러리, 프레임워크 그리고 프로젝트에서 쓰는 외부 시스템)도 중요하다.
이 코드는 작성한 코드만큼이나 소프트웨어 작동에 영향을 미친다.
최상의 보호를 위해서는 테스트가 해당 라이브러리, 프레임워크, 외부 시스템을 테스트 범주에 포함시켜서 소프트웨어가 이러한 의존성에 대해 검증이 올바른지 확인한다.
```

#### 4.1.2 두 번째 요소: 리팩터링 내성

```markdown
거짓 양성은 허위 경보다.
실제로 기능이 의도한 대로 작동하지만 테스트는 실패를 나타내는 결과다.
이러한 거짓 양성은 일반적으로 코드를 리팩터링할 때, 즉 구현을 수정하지만 식별할 수 있는 동작은 유지할 때 발생한다.
따라서 좋은 단위 테스트의 한 가지 특성으로 이름 붙이자면 '리팩터링 내성'이라 할 수 있다.
...
왜 그렇게 거짓 양성을 신경 쓰는가?
전체 테스트 스위트에 치명적인 영향을 줄 수 있기 때문이다.
```

#### 4.1.3 무엇이 거짓 양성의 원인인가?

```markdown
그렇다면 무엇이 거짓 양성의 원인인가? 그리고 어떻게 피할 수 있을까?
테스트에서 발생하는 거짓 양성의 수는 테스트 구성 방식과 직접적인 관련이 있다.
...
거짓 양성이 생길 가능성을 줄이는 방법은 해당 구현 세부 사항에서 테스트를 분리하는 것뿐이다.
...
테스트는 최종 사용자의 관점에서 SUT를 검증해야 하고 최종 사용자에게 의미 있는 결과만 확인해야 한다.
다른 모든 것은 무시해야 한다.
```

### 4.3 세 번째 요소와 네 번째 요소: 빠른 피드백과 유지 보수성

```markdown
- 빠른 피드백
- 유지 보수성
빠른 피드백은 단위 테스트의 필수 속성이다.
테스트 속도가 빠를수록 스위트에서 더 많은 테스트를 수행할 수 있고 더 자주 실행할 수 있다.
...
느린 테스트는 피드백을 느리게 하고 잠재적으로 버그를 뒤늦게 눈에 띄게 해서 버그 수정 비용이 증가한다.
오래 걸리는 테스트는 자주 실행하지 못하기 때문에 잘못된 방향으로 가면서 시간을 더 많이 낭비하게 된다.
```

### 4.4 이상적인 테스트를 찾아서

```markdown
좋은 단위 테스트의 4대 특성을 다시 보면 다음과 같다.
- 회귀 방지
- 리팩터링 내성
- 빠른 피드백
- 유지 보수성
이 네 가지 특성을 곱하면 테스트의 가치가 결정된다.
여기서 곱셈은 수학적인 의미의 곱셈이다.
즉, 어떤 특성이라도 0이 되면 전체가 0이 된다.
```

#### 4.5.2 블랙박스 테스트와 화이트박스 테스트 간의 선택

```markdown
블랙박스 테스트는 시스템의 내부 구조를 몰라도 시스템의 기능을 검사할 수 있는 소프트웨어 테스트 방법이다.
일반적으로 명세와 요구사항, 즉 애플리케이션이 어떻게 해야 하는지가 아니라 무엇을 해야 하는지를 중심으로 구축된다.
화이트박스 테스트는 정반대다.
애플리케이션의 내부 작업을 검증하는 테스트 방식이며, 테스트는 요구 사항이나 명세가 아닌 소스 코드에서 파생된다. 
```
