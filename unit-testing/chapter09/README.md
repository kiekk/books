## 9장. 목 처리에 대한 모범 사례

### 9.2 목 처리에 대한 모범 사례

#### 9.2.1 목은 통합 테스트만을 위한 것

```markdown
목이 통합 테스트만을 위한 것이며 단위 테스트에서 목을 사용하면 안 된다는 지침은 7장에서 설명한 기본 원칙인 비즈니스 로직과 오케스트레이션의 분리에서 비롯된다.
코드가 복잡하거나 프로세스 외부 의존성과 통신할 수 있지만, 둘 다는 아니다.
이 원칙은 자연스럽게 도메인 모델(복잡도 처리)과 컨트롤러(통신 처리)라는 고유 계층 두 개로 만들어지게 된다.
도메인 모델에 대한 테스트는 단위 테스트 범주에 속하며, 컨트롤러를 다루는 테스트는 통합 테스트다.
목은 비관리 의존성에만 해당하며 컨트롤러만 이러한 의존성을 처리하는 코드이기 때문에 통합 테스트에서 컨트롤러를 테스트할 때만 목을 적용해야 한다. 
```

#### 9.2.3 호출 횟수 검증하기

```markdown
비관리 의존성과의 통신에 관해서는 다음 두 가지 모두 확인하는 것이 중요하다.
- 예상하는 호출이 있는가?
- 예상치 못한 호출은 없는가?
이 요구 사항은 다시 비관리 의존성과 하위 호환성을 지켜야 하는 데서 비롯된다.
호환성은 양방향이어야 한다.
즉, 애플리케이션은 외부 시스템이 예상하는 메시지를 생략해서는 안 되며 예상치 못한 메시지도 생성해서는 안 된다.
```
