## 2장. 단위 테스트란 무엇인가

```markdown
1장에서 언급했듯이 단위 테스트의 정의에는 놀랄 만큼 많은 뉘앙스가 있다.
이러한 뉘앙스는 생각보다 훨씬 중요하다.
해석의 차이가 생겼고, 단위 테스트에 접근하는 방법이 두가지 뚜렷한 견해로 나뉘었다.
이러한 두 가지 견해는 각각 '고전파(classical school)'와 '런던파(london school)'로 알려져 있다.
고전파는 모든 사람이 단위 테스트와 테스트 주도 개발에 원론적으로 접근하는 방식이기 때문에 '고전'이라고 한다.
런던파는 런던의 프로그래밍 커뮤니티에서 시작됐다.
```

### 2.1 '단위 테스트'의 정의

```markdown
단위 테스트는
- 작은 코드 조각(단위라고도 함)을 검증하고,
- 빠르게 수행하고,
- 격리된 방식으로 처리하는 자동화된 테스트다.
여기서 처음 두 속성은 논란의 여지가 없다.
...
대중의 의견이 크게 다른 것은 세 번째 속성이다.
격리 문제는 단위 테스트의 고전파와 런던파를 구분할 수 있게 해주는 근원적 차이에 속한다.
```

#### 2.1.1 격리 문제에 대한 런던파의 접근

```markdown
런던파에서는 테스트 대상 시스템을 협력자(collaborator)에게서 격리하는 것을 일컫는다.
즉, 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존하면 이 모든 의존성을 테스트 대역(test double)으로 대체해야 한다.
이런 식으로 동작을 외부 영향과 분리해서 테스트 대상 클래스에만 집중할 수 있다.
...
의존성을 가진 코드베이스를 테스트하는 것은 테스트 대역 없이는 어렵다.
```
`Tip: 테스트 대상 메서드(Method Under Test)는 테스트에서 호출한 SUT(System Under Test)의 메서드다.
MUT와 SUT는 흔히 동의어로 사용하지만, 일반적으로는 MUT는 메서드를 가리키는 데 반해 SUT는 클래스 전체를 가리킨다.`

#### 2.1.2 격리 문제에 대한 고전파의 접근

```markdown
고전적인 방법에서 코드를 꼭 격리하는 방식으로 테스트해야 하는 것은 아니다.
대신 단위 테스트는 서로 격리해서 실행해야 한다.
이렇게 하면 테스트를 어떤 순서(병렬이나 순차 등)로든 가장 적합한 방식으로 실행할 수 있으며 서로의 결과에 영향을 미치지 않는다.
각각의 테스트를 격리하는 것은 여러 클래스가 모두 메모리에 상주하고 공유 상태에 도달하지 않는 한, 여러 클래스를 한 번에 테스트해도 괜찮다는 뜻이다.
이를 통해 테스트가 서로 소통하고 실행 컨텍스트에 영향을 줄 수 있다.
데이터베이스, 파일 시스템 등 프로세스 외부 의존성이 이러한 공유 상태의 대표적인 예다.
```

#### 2.3.4 고전파와 런던파 사이의 다른 차이점

```markdown
런던 스타일의 단위 테스트는 하향식 TDD로 이어지며, 전체 시스템에 대한 기대치를 설정하는 상위 레벨 테스트부터 시작한다.
목을 사용해 예상 결과를 달성하고자 시스템이 통신해야 하는 협력자를 지정한다.
그런 다음 모든 클래스를 구현할 때까지 클래스 그래프를 다져나간다.
목은 한 번에 한 클래스에 집중할 수 있기 때문에 이 설계 프로세스를 가능하게 한다.
테스트할 때 SUT의 모든 협력자를 차단해 해당 협력자의 구현을 나중으로 미룰 수 있다.
고전파는 테스트에서 실제 객체를 다뤄야 하기 때문에 지침을 똑같이 두지 않는다.
대신 일반적으로 상향식으로 한다.
고전적 스타일에서는 도메인 모델을 시작으로 최종 사용자가 소프트웨어를 사용할 수 있을 때까지 계층을 그 위에 더 둔다.
그러나 고전파와 런던파 간의 가장 중요한 차이점은 과도한 명세 문제, 즉 테스트가 SUT의 구현 세부 사항에 결합되는 것이다.
런던 스타일은 고전 스타일보다 테스트가 구현에 더 자주 결합되는 편이다.
이로 인해 런던 스타일과 목을 전반적으로 아무 데나 쓰는 것에 대해 주로 이의가 제기된다.
```
